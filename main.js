(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&"SCRIPT"===o.currentScript.tagName.toUpperCase()&&(t=o.currentScript.src),!t)){var n=o.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-33",headers:{authorization:localStorage.getItem("authToken")||"","Content-Type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(e,t,o,n,r,c){var a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),i=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-count");return u.src=e.link,u.alt=e.name,i.textContent=e.name,d.textContent=e.likes.length,e.likes.some((function(e){return e._id===c}))&&s.classList.add("card__like-button_is-active"),s.addEventListener("click",(function(){o(e,s,d)})),c?s.addEventListener("click",(function(){o(e,s,d)})):(s.style.pointerEvents="none",s.style.opacity="0.5"),e.owner._id!==c&&(l.style.display="none"),l.addEventListener("click",(function(){r(a,e._id)})),u.addEventListener("click",(function(){return n(e)})),a},r=function(e,n,r){var c;n.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then(o)}(e._id).then((function(t){e.likes=t.likes,n.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log("Ошибка при дизлайке: ".concat(e))})):(c=e._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(c),{method:"PUT",headers:{authorization:t.headers.authorization}}).then(o)).then((function(t){e.likes=t.likes,n.classList.add("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(e){return console.log("Ошибка при лайке: ".concat(e))}))},c=function(e){e.classList.add("popup_is-animated"),document.addEventListener("keydown",u),setTimeout((function(){e.classList.add("popup_is-opened")}),10)},a=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u),setTimeout((function(){e.classList.remove("popup_is-animated")}),600)},u=function(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))},i=function(e,t,o){var n=e.querySelector(".popup__input-error_type_".concat(t.name));t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},l=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))},s=function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){o.setCustomValidity(""),i(e,o,t)})),l(o,n,t)};const d=e.p+"db284478c90108936061.svg",p=e.p+"a636e5ce9382329e76e6.svg",f=e.p+"bed8c136e13907f5eefb.svg",_=e.p+"8018932fc080ecc35898.svg",m=e.p+"d97ff6d146127b17e5e5.svg",y=e.p+"4dd84d75e9f1e85912fb.svg",h=e.p+"6c7bf05444b9793fdf6e.svg",v=e.p+"d61c93de6ce14b130ef7.svg",g=e.p+"105d9cc63cd4f18fa42e.svg",b=e.p+"8076363e1296de8f234b.svg",S=e.p+"0863e5bc26221680f1e2.svg",k=e.p+"509b0c654142797bf057.svg";var q=document.querySelector(".theme-toggle"),C=null==q?void 0:q.querySelector(".theme-toggle__icon"),L=document.querySelector(".logo"),E=document.querySelector(".cohort__logout-button"),x=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),w=document.querySelector(".cohort__auth-button"),I=function(e){E&&(E.style.backgroundImage="url(".concat(e?b:g,")")),x&&(x.style.backgroundImage="url(".concat(e?v:h,")")),T&&(T.style.backgroundImage="url(".concat(e?_:f,")")),w&&(w.style.backgroundImage="url(".concat(e?y:m,")")),L&&(L.src=e?k:S);var t=e?"#000":"#fff";E&&(E.style.borderColor=t),x&&(x.style.borderColor=t),T&&(T.style.borderColor=t),w&&(w.style.borderColor=t),q&&(q.style.borderColor=t)},z="light"===(localStorage.getItem("theme")||"dark");document.body.classList.toggle("light-theme",z),document.body.classList.toggle("dark-theme",!z),C&&(C.src=z?d:p),I(z),q&&q.addEventListener("click",(function(){var e=document.body.classList.toggle("light-theme");document.body.classList.toggle("dark-theme",!e),C&&(C.src=e?d:p),I(e),localStorage.setItem("theme",e?"light":"dark")}));var U,A={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},B=document.querySelector(".places__list"),P=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup_type_image"),N=document.querySelector('.popup__form[name="edit-profile"]'),M=document.querySelector('.popup__form[name="new-place"]'),H=document.querySelector(".popup_type_new-card .popup__form"),O=document.querySelector(".profile__edit-button"),J=document.querySelector(".profile__add-button"),V=document.querySelector(".profile__image"),$=D.querySelector(".popup__image"),G=D.querySelector(".popup__caption"),F=document.querySelector(".profile__title"),R=document.querySelector(".profile__description"),K=N.querySelector(".popup__input_type_name"),Q=N.querySelector(".popup__input_type_description"),W=H.querySelector(".popup__input_type_card-name"),X=H.querySelector(".popup__input_type_url"),Y=document.querySelector(".popup_type_confirm-delete"),Z=Y.querySelector(".popup__button_type_confirm"),ee=null,te=document.querySelector(".popup_type_edit-avatar"),oe=te.querySelector(".popup__form"),ne=oe.querySelector(".popup__input_type_avatar-link"),re=H.querySelector('button[type="submit"]'),ce=N.querySelector('button[type="submit"]'),ae=oe.querySelector('button[type="submit"]'),ue=document.querySelector(".profile"),ie=document.querySelector(".popup_type_auth"),le=document.querySelector(".cohort__auth-button"),se=document.querySelector(".popup__form-auth"),de=se.querySelector(".popup__input_type_auth-token"),pe=document.querySelector(".cohort__logout-button"),fe=function(e){$.src=e.link,$.alt=e.name,G.textContent=e.name,c(D)},_e=function(e){ue.classList.toggle("profile_hidden",!e)};O.addEventListener("click",(function(){K.value=F.textContent,Q.value=R.textContent,s(N,A),c(P)})),N.addEventListener("submit",(function(e){e.preventDefault();var n,r,c=K.value,u=Q.value;ce.textContent="Сохранение...",(n=c,r=u,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:r})}).then(o)).then((function(e){F.textContent=e.name,R.textContent=e.about,a(P)})).catch((function(e){console.log("Ошибка при обновлении профиля: ".concat(e))})).finally((function(){ce.textContent="Сохранить"}))})),J.addEventListener("click",(function(){H.reset(),s(M,A),c(j)})),H.addEventListener("submit",(function(e){e.preventDefault();var c,u,i=W.value,l=X.value;re.textContent="Сохранение...",(c=i,u=l,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:c,link:u})}).then(o)).then((function(e){e.owner={_id:U};var t=n(e,0,r,fe,me,U);B.prepend(t),H.reset(),a(j)})).catch((function(e){console.log("Ошибка при добавлении карточки: ".concat(e))})).finally((function(){re.textContent="Сохранить"}))}));var me=function(e,t){ee={cardElement:e,cardId:t},c(Y)};Z.addEventListener("click",(function(){if(ee){var e=Z.textContent;Z.textContent="Удаление...",(n=ee.cardId,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then(o)).then((function(){ee.cardElement.remove(),a(Y)})).catch((function(e){console.log("Ошибка при удалении карточки: ".concat(e))})).finally((function(){Z.textContent=e}))}var n})),V.addEventListener("click",(function(){oe.reset(),s(oe,A),c(te)})),oe.addEventListener("submit",(function(e){e.preventDefault();var n=ne.value;ae.textContent="Сохранение...",function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(o)}(n).then((function(e){V.style.backgroundImage="url('".concat(e.avatar,"')"),a(te)})).catch((function(e){console.log("Ошибка при обновлении аватара: ".concat(e))})).finally((function(){ae.textContent="Сохранить"}))}));var ye=function(e){e.preventDefault();var t=de.value.trim();if(!t)return console.log("Ошибка: Токен не может быть пустым!");localStorage.setItem("authToken",t),he(),a(ie)};le.addEventListener("click",(function(){return c(ie)})),se.addEventListener("submit",ye);var he=function(){var e=localStorage.getItem("authToken");e?(t.headers.authorization=e,le.style.display="none",pe.style.display="block",pe.classList.add("cohort__logout-button"),_e(!0),fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:{authorization:t.headers.authorization}}).then(o).then((function(e){U=e._id,F.textContent=e.name,R.textContent=e.about,V.style.backgroundImage="url('".concat(e.avatar,"')"),ve()})).catch((function(e){return console.log("Ошибка при загрузке профиля: ".concat(e))}))):(le.style.display="block",pe.style.display="none",_e(!1)),ve()},ve=function(){var e;(e=localStorage.getItem("authToken")||"e9c36c88-ea0b-42d7-9bce-1a792a146069",fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:{authorization:e,"Content-Type":"application/json"}}).then(o)).then((function(e){B.innerHTML="",e.forEach((function(e){var t=n(e,0,r,fe,me,U);B.append(t)}))})).catch((function(e){console.log("Ошибка при загрузке карточек: ".concat(e))}))};document.querySelectorAll(".popup").forEach((function(e){!function(e){var t=e.querySelector(".popup__close");t&&t.addEventListener("click",(function(){return a(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&a(e)}))}(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);l(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,o):function(e,t,o,n){var r=e.querySelector(".popup__input-error_type_".concat(t.name));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),l(o,n,t)}))}))}(t,e)}))}(A),le.addEventListener("click",(function(){se.reset(),s(se,A),c(ie)})),se.addEventListener("submit",ye),he(),pe.addEventListener("click",(function(){localStorage.removeItem("authToken"),t.headers.authorization="",le.style.display="block",pe.style.display="none",U=null,F.textContent="Имя",R.textContent="Описание",V.style.backgroundImage="",B.innerHTML="",_e(!1),ve()}))})();